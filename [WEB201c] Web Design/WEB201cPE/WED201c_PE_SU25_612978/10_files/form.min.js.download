((n,m)=>{XF.SubmitClick=XF.Event.newHandler({eventNameSpace:"XFSubmitClick",options:{target:null,container:null,timeout:500,uncheckedValue:"0",disable:null},input:null,form:null,init(){var a=this.target;if(a.matches("label")&&(a=a.querySelector('input[type="radio"], input[type="checkbox"]'),!a))return;this.input=a;this.form=(a=a.closest("form"))?a:null},click(a){const b=this.input,c=this.form,e=this.options.target,f=this.options.container;if(b)if(e){const d=this.options.uncheckedValue;setTimeout(()=>
{var k={};f?(k=b.closest(f).querySelectorAll("input, select, textarea"),k=XF.Serializer.serializeArray(k)):k[b.getAttribute("name")]=b.checked?b.value:d;XF.ajax("POST",e,k)},0)}else c?((a=XF.DataStore.get(c,"submit-click-timer"))&&clearTimeout(a),XF.on(c,"ajax-submit:complete",d=>{({data:d}=d);if(d.errors)b.checked=b.checked?"":"checked";else if("checkbox"==b.getAttribute("type")&&null!==b.closest("tr.dataList-row"))b.closest("tr.dataList-row").classList[b.checked?"remove":"add"]("dataList-row--disabled")},
{once:!0}),a=setTimeout(()=>XF.trigger(c,"submit"),this.options.timeout),XF.DataStore.set(c,"submit-click-timer",a)):console.error("No target or form to submit on click")}});XF.AjaxSubmit=XF.Element.newHandler({options:{redirect:!0,skipOverlayRedirect:!1,forceFlashMessage:!1,resetComplete:!1,hideOverlay:!0,disableSubmit:'.button, input[type="submit"], input[type="reset"], [data-disable-submit]',jsonName:null,jsonOptIn:null,replace:null,showReplacement:!0},submitPending:!1,submitButton:null,init(){const a=
this.target;a.matches("form")?(XF.on(a,"submit",this.submit.bind(this)),XF.on(a,"draft:beforesave",this.draftCheck.bind(this)),XF.onDelegated(a,"click","input[type=submit], button:not([type]), button[type=submit]",this.submitButtonClicked.bind(this))):console.error("%o is not a form",a)},submit(a){const b=this.submitButton,c=this.target,e="multipart/form-data"==c.getAttribute("enctype");if(e){if(this.options.jsonName){a.preventDefault();console.error("JSON serialized forms do not support the file upload-style enctype.");
XF.alert(XF.phrase("oops_we_ran_into_some_problems_more_details_console"));return}if(!n.FormData)return}if(!(this.submitButton&&this.submitButton.dataset.preventAjax||XF.debug.disableAjaxSubmit))if(this.submitPending)null==a||a.preventDefault();else{var f={skipDefault:!0};e&&(f.timeout=0);var d=XF.customEvent("ajax-submit:before",{form:c,handler:this,method:c.getAttribute("method")||"get",action:c.getAttribute("action"),submitButton:b,preventSubmit:!1,successCallback:this.submitResponse.bind(this),
ajaxOptions:f});XF.trigger(c,d);d.preventSubmit?(null==a||a.stopPropagation(),null==a||a.preventDefault()):d.defaultPrevented||(null==a||a.preventDefault(),setTimeout(()=>{this.submitPending=!0;const k=XF.getDefaultFormData(c,b,this.options.jsonName,this.options.jsonOptIn);this.disableButtons();XF.ajax(d.method,d.action,k,d.successCallback,d.ajaxOptions).finally(()=>{this.submitButton=null;setTimeout(()=>{this.submitPending=!1;this.enableButtons()},300);XF.trigger(c,"ajax-submit:always")})},0))}},
disableButtons(){Array.from(this.target.querySelectorAll(this.options.disableSubmit)).forEach(a=>{a.disabled=!0})},enableButtons(){Array.from(this.target.querySelectorAll(this.options.disableSubmit)).forEach(a=>{a.disabled=!1})},submitResponse(a,b,c){if("object"!=typeof a)XF.alert("Response was not JSON.");else{b=this.target;c=this.submitButton;var e=XF.customEvent("ajax-submit:response",{data:a});XF.trigger(b,e);if(!e.defaultPrevented){var f=XF.customEvent("ajax-submit:error",{data:a}),d=e=!1,k=
a.redirect&&this.options.redirect,h=b.closest(".overlay");h&&this.options.hideOverlay||(h=null);k&&this.options.skipOverlayRedirect&&h&&(k=!1);c&&c.getAttribute("data-ajax-redirect")&&(k=XF.toBoolean(c.dataset.ajaxRedirect));a.errorHtml?(XF.trigger(b,f),f.defaultPrevented||XF.setupHtmlInsert(a.errorHtml,(l,g)=>{g=g.h1||g.title||XF.phrase("oops_we_ran_into_some_problems");XF.overlayMessage(g,l)}),e=!0):a.errors?(XF.trigger(b,f),f.defaultPrevented||XF.alert(a.errors),e=!0):a.exception?XF.alert(a.exception):
"ok"==a.status&&a.message?(k?this.options.forceFlashMessage?(XF.flashMessage(a.message,1E3,()=>XF.redirect(a.redirect)),d=!0):XF.redirect(a.redirect):(XF.flashMessage(a.message,3E3),d=!0),h&&XF.trigger(h,"overlay:hide")):a.html?XF.setupHtmlInsert(a.html,(l,g,p)=>{if(this.options.replace&&this.doSubmitReplace(l,p))return!1;h&&XF.trigger(h,"overlay:hide");l=XF.getOverlayHtml({html:l,title:g.h1||g.title});XF.showOverlay(l)}):"ok"==a.status&&(k&&XF.redirect(a.redirect),h&&XF.trigger(h,"overlay:hide"));
!d&&a.flashMessage&&XF.flashMessage(a.flashMessage,3E3);c=XF.customEvent("ajax-submit:complete",{data:a});XF.trigger(b,c);c.defaultPrevented||this.options.resetComplete&&!e&&b.reset()}}},doSubmitReplace(a,b){var c=this.options.replace;if(!c)return!1;var e=c.split(" with ");c=e[0].trim();e=e[1]?e[1].trim():c;let f,d;"self"==c||this.target.matches(c)?f=this.target:(f=this.target.querySelector(c))||(f=m.querySelector(c));if(!f)return console.error("Could not find old selector '"+c+"'"),!1;d=a.matches(e)?
a:a.querySelector(e);if(!d)return console.error("Could not find new selector '"+e+"'"),!1;this.options.showReplacement?(XF.display(d,"none"),f.insertAdjacentElement("afterend",d),XF.Animate.fadeUp(f,{speed:XF.config.speed.normal,complete(){f.remove();d&&(XF.activate(d),b(!1),XF.Animate.fadeDown(d,{complete:XF.layoutChange}))}})):(f.insertAdjacentElement("afterend",d),f.remove(),d&&(XF.activate(d),b(!1)),XF.layoutChange());return!0},submitButtonClicked(a){this.submitButton=a.target.closest("button")},
draftCheck(a){this.submitPending&&a.preventDefault()}});XF.ChangeSubmit=XF.Element.newHandler({options:{watch:":is(input, select, textarea)",submitDelay:0},formInitialized:!1,hasChanges:!1,hasPendingChanges:!1,hasUnsavedChanges:!1,clickOnSuccessfulSave:null,delayTimeout:null,init(){XF.onDelegated(this.target,"change",this.options.watch,this.change.bind(this));XF.onDelegated(this.target,"focus",this.options.watch,()=>{this.clearSubmitTimeout()});XF.onDelegated(this.target,"blur",this.options.watch,
a=>{this.hasPendingChanges&&this.scheduleSubmit()});XF.onDelegated(this.target,"click","[type=reset]",this.revert.bind(this));XF.on(this.target,"submit",()=>{this.hasPendingChanges=!1});XF.on(this.target,"ajax-submit:complete",a=>{({data:a}=a);if("ok"===a.status){this.hasUnsavedChanges=!1;const b=this.clickOnSuccessfulSave;b&&(this.clickOnSuccessfulSave=null,setTimeout(()=>{XF.trigger(b,"click")},100))}});this.target.querySelectorAll("[data-force-change-submit]").forEach(a=>{XF.on(a,"click",b=>{this.hasUnsavedChanges&&
(b.stopPropagation(),b.stopImmediatePropagation(),this.clickOnSuccessfulSave=b.target,this.triggerSubmit())})})},initForm(){this.formInitialized||(this.formInitialized=!0,XF.Element.applyHandler(this.target,"ajax-submit",{redirect:!1,forceFlashMessage:!1}),XF.Element.getHandler(this.target,"ajax-submit").options.redirect=!1)},change(a){this.initForm();this.hasUnsavedChanges=this.hasChanges=!0;this.clickOnSuccessfulSave=null;this.validateGroup(a.target.dataset.group)&&(this.hasPendingChanges=!0,this.scheduleSubmit())},
clearSubmitTimeout(){this.delayTimeout&&clearTimeout(this.delayTimeout);this.delayTimeout=null},scheduleSubmit(){const a=this.options.submitDelay;0<a?(this.clearSubmitTimeout(),this.delayTimeout=setTimeout(this.triggerSubmit.bind(this),a)):this.triggerSubmit()},triggerSubmit(){this.clearSubmitTimeout();XF.trigger(this.target,"submit")},validateGroup(a){if(!a)return!0;let b=!0;this.target.querySelectorAll(`[data-group='${a}']`).forEach(c=>{c.dataset.required&&""===c.value&&(b=!1)});return b},revert(a){a.preventDefault();
this.hasChanges&&(this.hasChanges=!1,XF.trigger(this.target,"reset"),this.triggerSubmit())}});XF.UserMentioner=XF.Element.newHandler({options:{},handler:null,init(){this.handler=new XF.AutoCompleter(this.target,{url:XF.getAutoCompleteUrl()})}});XF.EmojiCompleter=XF.Element.newHandler({options:{insertTemplate:"${text}",excludeSmilies:!1,triggerString:":",insertEmoji:!1},handler:null,init(){if(XF.config.shortcodeToEmoji){var a="index.php?misc/find-emoji";this.options.excludeSmilies&&(a+="&exclude_smilies=1");
this.options.insertEmoji&&(a+="&insert_emoji=1");a={url:XF.canonicalizeUrl(a),at:this.options.triggerString,keepAt:!1,insertMode:this.options.insertEmoji?"html":"text",displayTemplate:'<div class="contentRow"><div class="contentRow-figure contentRow-figure--emoji">{{{icon}}}</div><div class="contentRow-main contentRow-main--close">{{{text}}}<div class="contentRow-minor contentRow-minor--smaller">{{{desc}}}</div></div></div>',beforeInsert(b){XF.logRecentEmojiUsage(b);return b}};this.options.insertEmoji&&
(a.suffix="");this.handler=new XF.AutoCompleter(this.target,a)}}});XF.AutoSubmit=XF.Element.newHandler({options:{hide:!0,progress:!0},init(){XF.trigger(this.target,"submit")&&this.target.submit();if(this.options.hide){const a=this.target.querySelector('button[type="submit"]');XF.display(a,"none")}this.options.progress&&XF.trigger(m,"xf:action-start")}});XF.CheckAll=XF.Element.newHandler({options:{container:"< form",match:'input[type="checkbox"]'},container:null,updating:!1,init(){const a=XF.findRelativeIf(this.options.container,
this.target,!1);let b=[];a instanceof NodeList?b=Array.from(a):b.push(a);this.container=b;b.forEach(c=>{XF.onDelegated(c,"click",this.options.match,e=>{this.updating||e.target!==this.target&&this.updateState()})});XF.on(this.target.closest("form"),"selectplus:redrawSelected",this.updateState.bind(this));this.updateState();XF.on(this.target,"click",this.click.bind(this))},click(a){this.updating=!0;this.getCheckBoxes().forEach(b=>{b.checked=a.target.checked;XF.trigger(b,"click")});this.updating=!1},
updateState(){const a=this.getCheckBoxes();let b=0<a.length;a.forEach(c=>{if(!c.checked)return b=!1});this.target.checked=b},getCheckBoxes(){const a=[];this.container.forEach(b=>{b=b.querySelectorAll(this.options.match);a.push(...Array.from(b))});return a.filter(b=>b!==this.target&&!b.disabled)}});XF.SelectPlus=XF.Element.newHandler({options:{spCheckbox:null,spContainer:".js-spContainer",activeClass:"is-spActive",checkedClass:"is-spChecked",hoverClass:"is-spHovered",spMultiBarUrl:null,spDebug:!0},
containers:null,checkboxes:null,multiBar:null,isActive:!1,isShifted:!1,lastSelected:null,lastEntered:null,init(){this.checkboxes=this.target.querySelectorAll(this.options.spCheckbox?this.options.spCheckbox:'input[type="checkbox"]');this.containers=Array.from(this.checkboxes).map(a=>a.closest(this.options.spContainer));this.debug("init; containers: %o, checkboxes: %o",this.containers.length,this.checkboxes.length);this.containers.length!=this.checkboxes.length?console.error("There must be an equal number of checkboxes and containers"):
(Array.from(this.checkboxes).forEach(a=>{XF.on(a,"click",this.checkboxClick.bind(this));if(a=a.closest("label"))XF.on(a,"mouseenter",this.checkboxEnter.bind(this)),XF.on(a,"mouseleave",this.checkboxExit.bind(this))}),XF.on(m,"keydown",this.keydown.bind(this),{passive:!0}),XF.on(m,"keyup",this.keyup.bind(this),{passive:!0}),Array.from(this.containers).forEach(a=>{XF.on(a,"mousedown",b=>{this.isActive&&(b.ctrlKey||b.shiftKey)&&(a.onselectstart=()=>!1,setTimeout(()=>{a.onselectstart=null},0))})}),this.setActive(),
this.redrawSelected())},checkboxClick(a){if(!this.ignoreClick){this.debug("checkboxClick; delegateTarget: %o",a.currentTarget);var b=Array.from(this.checkboxes).indexOf(a.currentTarget);a.currentTarget.checked&&this.isShifted&&null!==this.lastSelected?(this.ignoreClick=!0,b=this.getShiftItems(this.checkboxes,b),Array.from(b).filter(c=>!c.checked).forEach(c=>c.click()),this.ignoreClick=!1):this.lastSelected=a.currentTarget.checked?b:null;this.setActive(a.currentTarget.checked);this.redrawSelected()}},
checkboxExit(a){this.lastEntered=null},checkboxEnter(a){this.isActive&&(a=a.currentTarget.querySelector('input[type="checkbox"]'),this.lastEntered=Array.from(this.checkboxes).indexOf(a),this.isShifted&&this.redrawHover())},keydown(a){"Shift"==a.key&&XF.Keyboard.isShortcutAllowed(m.activeElement)&&(this.isShifted=!0,this.redrawHover())},keyup(a){"Shift"==a.key&&this.isShifted&&(this.isShifted=!1,this.redrawHover())},getShiftItems(a,b){return null!==b&&null!==this.lastSelected?(a=Array.from(a).slice(Math.min(b,
this.lastSelected),Math.max(b,this.lastSelected)+1),this.debug("shiftItems:",a),a):[]},setActive(a){const b=this.isActive;this.isActive=a?!0:Array.from(this.checkboxes).some(c=>c.checked);this.deployMultiBar();this.isActive!=b&&(this.debug("setActive: %s",this.isActive),XF.trigger(this.target,this.isActive?"selectplus:activate":"selectplus:deactivate",{selectPlus:this}),XF.Transition.toggleClassTransitioned(this.target,this.options.activeClass,this.isActive),XF.Transition.toggleClassTransitioned(m.body,
"is-spDocTriggered",this.isActive))},redrawSelected(){XF.trigger(this.target,"selectplus:redraw-selected",{selectPlus:this});this.checkboxes.forEach((a,b)=>{const c=a.checked;b=this.containers[b];XF.Transition.toggleClassTransitioned(b,this.options.checkedClass,c);a.dataset.checkState!=c&&XF.trigger(b,"selectplus:toggle-item",{selectPlus:this,checkState:c});a.dataset.checkState=c})},redrawHover(){XF.trigger(this.target,"selectplus:redraw-hover",{selectPlus:this});if(null!==this.lastSelected&&null!==
this.lastEntered&&this.isShifted){const a=this.getShiftItems(this.containers,this.lastEntered);this.debug("redrawHover: lastSelected: %s, lastEntered: %s",this.lastSelected,this.lastEntered);Array.from(this.containers).forEach(b=>{a.includes(b)||b.classList.toggle(this.options.hoverClass)});a.forEach(b=>{XF.Transition.toggleClassTransitioned(b,this.options.hoverClass,!0)})}else this.containers.forEach(a=>{XF.Transition.toggleClassTransitioned(a,this.options.hoverClass,!1)})},deployMultiBar(){this.isActive&&
this.options.spMultiBarUrl?XF.loadMultiBar(this.options.spMultiBarUrl,this.checkboxes,{cache:!1,init(a){this.MultiBar&&this.MultiBar.destroy();this.MultiBar=a}},{fastReplace:this.MultiBar?!0:!1}):!this.active&&this.MultiBar&&this.MultiBar.hide()},debug(...a){this.options.spDebug&&(a[0]="SelectPlus:"+a[0],console.log(...a))}});XF.DescLoader=XF.Element.newHandler({options:{descUrl:null},container:null,changeTimer:null,abortController:null,init(){if(this.options.descUrl){var a=this.target.parentNode.querySelector(".js-descTarget");
a?(this.container=a,XF.on(this.target,"change",this.change.bind(this))):console.error("Target element must have a .js-descTarget sibling")}else console.error("Element must have a data-desc-url value")},change(){this.changeTimer&&clearTimeout(this.changeTimer);this.abortController&&(this.abortController.abort(),this.abortController=null);this.changeTimer=setTimeout(this.onTimer.bind(this),200)},onTimer(){var a=this.target.value;a?({abortController:a}=XF.ajaxAbortable("post",this.options.descUrl,{id:a},
this.onLoad.bind(this)),a&&(this.abortController=a)):XF.Animate.fadeUp(this.container,{speed:XF.config.speed.fast})},onLoad(a){const b=this.container;a.description?XF.setupHtmlInsert(a.description,(c,e,f)=>{XF.Animate.fadeUp(b,{speed:XF.config.speed.fast,complete(){b.innerHTML="";XF.isCreatedContainer(c)?b.append(...c.childNodes):b.append(c);XF.Animate.fadeDown(b)}})}):XF.Animate.fadeUp(b,{speed:XF.config.speed.fast});this.abortController=null}});XF.Disabler=XF.Element.newHandler({options:{container:"< li | ul, ol, dl",
controls:"input, select, textarea, button, .js-attachmentUpload",hide:!1,instant:!1,optional:!1,invert:!1,autofocus:!0},container:null,containers:[],init(){var a=XF.findRelativeIf(this.options.container,this.target,!1);a instanceof Element&&(this.containers=[a]);a instanceof NodeList&&(this.containers=Array.from(a));this.containers.length||this.options.optional||console.error("Could not find the disabler control container");const b=this.target;if(a=b.closest("form"))XF.on(a,"reset",this.formReset.bind(this));
if(b.matches('[type="radio"]')){a=a||m.body;const c=b.getAttribute("name");XF.onDelegated(a,"click",`input[type="radio"][name="${c}"]`,this.click.bind(this))}else if(b.matches("option")){const c=b.closest("select");XF.on(c,"change",e=>{e=Array.from(c.options).find(d=>d.selected);const f=XF.Element.getHandler(e,"disabler");e!==b&&f&&f.getOption("container")===this.options.container||this.recalculate(!1)})}else XF.on(b,"click",this.click.bind(this));XF.on(b,"control:enabled",this.recalculateAfter.bind(this));
XF.on(b,"control:disabled",this.recalculateAfter.bind(this));this.containers.forEach(c=>{XF.on(c,"editor:init",this.recalculateAfter.bind(this),{once:!0})});this.recalculate(!0)},click(a){this.recalculateAfter(!1,a.triggered||!1)},formReset(a){this.recalculateAfter(!1,!0)},recalculateAfter(a,b){setTimeout(()=>this.recalculate(a,b),0)},recalculate(a,b){const c=this.target,e=a||this.options.instant?0:XF.config.speed.fast;let f;if(c.disabled)f=!1;else{if(c.matches("option")){var d=c.closest("select");
d=d.options[d.selectedIndex]===c}else d=c.checked;f=this.options.invert?!d:d}let k=h=>{if(!b&&this.options.autofocus){var l;null==(l=Array.from(h.querySelectorAll("input:not([type=hidden], [type=file]), textarea, select, button")).filter(g=>g!==c)[0])||l.focus()}};this.containers.forEach(h=>{const l=Array.from(h.querySelectorAll(this.options.controls)).filter(g=>g!==c);f?(h.disabled=!1,h.classList.remove("is-disabled"),l.forEach(g=>{g.disabled=!1;g.classList.remove("is-disabled");"SELECT"===g.tagName&&
g.classList.contains("is-readonly")&&(g.disabled=!0);XF.trigger(g,"control:enabled")}),this.options.hide?(a?XF.display(h):XF.Animate.slideDown(h,{speed:e,complete(){XF.layoutChange();k(h)}}),XF.trigger(h,"toggle:shown"),XF.layoutChange()):a||k(h)):(this.options.hide&&(a?XF.display(h,"none"):XF.Animate.slideUp(h,{speed:e,complete:XF.layoutChange}),XF.trigger(h,"toggle:hidden"),XF.layoutChange()),h.disabled=!0,h.classList.add("is-disabled"),l.forEach(g=>{g.disabled=!0;g.classList.add("is-disabled");
XF.trigger(g,"control:disabled");let p=g.dataset.disabled;null!==p&&"undefined"!==typeof p&&(g.value=p)}))})}});XF.FieldAdder=XF.Element.newHandler({options:{incrementFormat:null,formatCaret:!0,removeClass:null,cloneInit:!1,remaining:-1},clone:null,cloned:!1,created:!1,init(){this.target.querySelectorAll("input:not([type=checkbox]), select, textarea").forEach(a=>{"SELECT"===a.tagName?a.querySelectorAll("option").forEach(b=>{b.selected=b.defaultSelected}):a.value=a.dataset.defaultValue||a.defaultValue||
""});this.options.cloneInit&&(this.clone=this.target.cloneNode(!0));XF.on(this.target,"keypress",this.handleEvent.bind(this));XF.on(this.target,"change",this.handleEvent.bind(this));XF.on(this.target,"paste",this.handleEvent.bind(this));XF.on(this.target,"input",this.handleEvent.bind(this))},handleEvent(a){a.target.readOnly||this.cloned||(this.cloned=!0,this.clone||(this.clone=this.target.cloneNode(!0)),XF.off(this.target,a.type),this.create())},create(){if(!this.created&&(this.created=!0,0!=this.options.remaining)){var a=
this.options.incrementFormat,b=this.options.formatCaret?"^":"";if(this.options.incrementFormat){const c=new RegExp(b+XF.regexQuote(a).replace("\\{counter\\}","(\\d+)"));this.clone.querySelectorAll("input, select, textarea").forEach(e=>{let f=e.name;f=f.replace(c,(d,k)=>a.replace("{counter}",parseInt(k,10)+1));e.name=f})}0<this.options.remaining&&this.clone.setAttribute("data-remaining",this.options.remaining-1);this.clone.querySelectorAll("input, select, textarea").forEach(c=>{"SELECT"===c.tagName?
c.querySelectorAll("option").forEach(e=>{e.selected=e.defaultSelected}):"string"===typeof c.defaultValue&&(c.value=c.defaultValue)});this.target.insertAdjacentElement("afterend",this.clone);this.options.removeClass&&this.target.classList.remove(...this.options.removeClass.split(" "));XF.activate(this.clone);XF.layoutChange()}}});XF.FormSubmitRow=XF.Element.newHandler({options:{container:".block-container",fixedChild:".formSubmitRow-main",stickyClass:"is-sticky",topOffset:100,minWindowHeight:281},
container:null,fixedParent:null,fixEl:null,fixElHeight:0,winHeight:0,containerTop:0,containerBorderLeftWidth:0,topOffset:0,elBottom:0,state:"normal",windowTooSmall:!1,init(){if(XF.config.enableFormSubmitSticky){var a=this.target,b=a.closest(this.options.container);b?(this.container=b,this.topOffset=this.options.topOffset,this.fixEl=a.querySelector(this.options.fixedChild),XF.on(n,"scroll",this.onScroll.bind(this)),XF.on(n,"resize",this.recalcAndUpdate.bind(this)),a=XF.getFixedOffsetParent(a),a.matches("html")||
(this.fixedParent=a,XF.on(a,"scroll",this.onScroll.bind(this))),XF.on(m.body,"xf:layout",this.recalcAndUpdate.bind(this)),setTimeout(this.recalcAndUpdate.bind(this),250)):console.error("Cannot float submit row, no container")}},recalc(){const a=this.target;this.winHeight=XF.windowHeight();this.elBottom=this.getTargetTop()+a.offsetHeight;this.fixElHeight=this.fixEl.offsetHeight;this.containerTop=XF.getFixedOffset(this.container).top;this.containerBorderLeftWidth=parseInt(getComputedStyle(this.container).borderLeftWidth,
10)},recalcAndUpdate(){this.state="normal";this.resetTarget();this.recalc();this.update()},getTargetTop(){const a=this.target.getBoundingClientRect().top;return this.fixedParent?a-this.fixedParent.getBoundingClientRect().top:a+n.scrollY},getScrollTop(){return this.fixedParent?this.fixedParent.scrollTop:m.documentElement.scrollTop},update(){var a=this.winHeight;if(a<this.options.minWindowHeight)"normal"!=this.state&&(this.resetTarget(),this.state="normal");else{var b=XF.NoticeWatcher.getBottomFixerNoticeHeight()||
0;this.container.closest(".overlay")&&(b=0);a=this.getScrollTop()+a-b;if(a>=this.elBottom)"normal"!=this.state&&(this.resetTarget(),this.state="normal");else{var c=this.containerTop+this.topOffset+this.fixElHeight;a<=c?c>=this.elBottom||"absolute"==this.state||(a=this.container.getBoundingClientRect(),"stuck"==this.state?(b=this.fixEl.parentNode,"static"==n.getComputedStyle(b).position&&(b=b.offsetParent)):b=this.fixEl.offsetParent,b=b.getBoundingClientRect(),this.fixEl.style.position="absolute",
this.fixEl.style.top=`${a.top-b.top+this.topOffset}px`,this.fixEl.style.right="auto",this.fixEl.style.bottom="auto",this.fixEl.style.left=`${a.left-b.left+this.containerBorderLeftWidth}px`,this.fixEl.style.width=`${this.container.clientWidth}px`,this.setTargetSticky(!0),this.state="absolute"):"stuck"!=this.state&&(a=this.container.getBoundingClientRect(),this.fixEl.style.position="",this.fixEl.style.top="",this.fixEl.style.right="",this.fixEl.style.bottom=`${b}px`,this.fixEl.style.left=`${a.left+
this.containerBorderLeftWidth}px`,this.fixEl.style.width=`${this.container.clientWidth}px`,this.setTargetSticky(!0),this.state="stuck")}}},resetTarget(){this.fixEl.style.position="";this.fixEl.style.top="";this.fixEl.style.right="";this.fixEl.style.bottom="";this.fixEl.style.left="";this.fixEl.style.width="";this.setTargetSticky(!1)},setTargetSticky(a){this.target.classList.toggle(this.options.stickyClass,a);this.target.style.height=`${this.fixEl.offsetHeight}px`},onScroll(){this.update()}});XF.GuestUsername=
XF.Element.newHandler({init(){const a=this.target;a.value=XF.LocalStorage.get("guestUsername");XF.on(a,"keyup",this.change.bind(this))},change(){const a=this.target;a.value.length?XF.LocalStorage.set("guestUsername",a.value,!0):XF.LocalStorage.remove("guestUsername")}});XF.MinLength=XF.Element.newHandler({options:{minLength:0,allowEmpty:!1,disableSubmit:!0,toggleTarget:null},met:null,form:null,toggleTarget:null,init(){this.form=this.target.closest("form");this.options.toggleTarget&&(this.toggleTarget=
XF.findRelativeIf(this.options.toggleTarget,this.target));const a=()=>{setTimeout(this.checkLimits.bind(this),0)};["change","keypress","keydown","paste"].forEach(b=>{XF.on(this.target,b,a)});this.options.allowEmpty||0!=this.options.minLength||(this.options.minLength=1);this.checkLimits()},checkLimits(){var a=this.target.value.trim().length;const b=this.options;a=a>=b.minLength||0==a&&b.allowEmpty;a!==this.met&&((this.met=a)?(b.disableSubmit&&this.form.querySelectorAll('[type="submit"]').forEach(c=>
{c.disabled=!1;c.classList.remove("is-disabled")}),this.toggleTarget&&XF.display(this.toggleTarget,"none")):(b.disableSubmit&&this.form.querySelectorAll('[type="submit"]').forEach(c=>{c.disabled=!0;c.classList.add("is-disabled")}),this.toggleTarget&&XF.display(this.toggleTarget)))}});XF.TextAreaHandler=XF.Element.newHandler({options:{autoSize:!0,keySubmit:!0,singleLine:null},initialized:!1,init(){this.options.autoSize&&(this.target.scrollHeight?this.setupAutoSize():(XF.on(this.target,"focus",this.setupDelayed.bind(this),
{once:!0}),XF.on(this.target,"control:enabled",this.setupDelayed.bind(this),{once:!0}),XF.on(this.target,"control:disabled",this.setupDelayed.bind(this),{once:!0}),XF.onWithin(this.target,"toggle:shown overlay:shown tab:shown quick-edit:shown",this.setupDelayed.bind(this))),XF.on(this.target,"autosize",this.update.bind(this)));if(this.options.keySubmit||this.options.singleLine)XF.on(this.target,"keydown",this.keySubmit.bind(this))},setupAutoSize(){this.initialized||(this.initialized=!0,autosize(this.target),
XF.on(this.target,"autosize:resized",()=>XF.layoutChange()))},setupDelayed(){if(this.initialized)this.update();else{const a=()=>{this.setupAutoSize();XF.layoutChange()};this.target.scrollHeight?a():setTimeout(a,100)}},update(){this.initialized?autosize.update(this.target):this.setupDelayed()},keySubmit(a){if("Enter"==a.key&&(this.options.singleLine||this.options.keySubmit&&(XF.isMac()?a.metaKey:a.ctrlKey))){const b=this.target.closest("form");switch(String(this.options.singleLine).toLowerCase()){case "next":this.target.nextElementSibling.focus();
break;case "blur":this.target.blur();break;default:b&&XF.trigger(b,"submit")&&b.submit()}a.preventDefault();a.stopPropagation()}}});XF.PasswordHideShow=XF.Element.newHandler({options:{showText:null,hideText:null},password:null,checkbox:null,label:null,init(){this.password=this.target.querySelector(".js-password");const a=this.target.querySelector(".js-hideShowContainer");this.checkbox=a.querySelector('input[type="checkbox"]');this.label=a.querySelector(".iconic-label");XF.on(this.checkbox,"change",
this.toggle.bind(this))},toggle(a){a=this.password;const b=this.label;this.checkbox.checked?(a.setAttribute("type","text"),b.textContent=this.options.hideText):(a.setAttribute("type","password"),b.textContent=this.options.showText)}});XF.InputValidator=XF.Element.newHandler({options:{delay:500,onBlur:!0,trim:!0,validateEmpty:!1,validationUrl:null,errorTarget:null},timeout:null,errorElement:null,validatedValue:null,init(){if(this.options.validationUrl){var a;if(a=this.options.errorTarget?XF.findRelativeIf(this.options.errorTarget,
this.target):this.target.parentNode.querySelector(".js-validationError")){this.errorElement=a;if(this.options.delay)XF.on(this.target,"input",this.onInput.bind(this));if(this.options.onBlur)XF.on(this.target,"blur",this.performValidation.bind(this))}else console.error("Unable to locate error element.")}else console.error("Element must have a data-validation-url value")},onInput(a){this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout(this.performValidation.bind(this),this.options.delay)},
performValidation(a){this.timeout&&(clearTimeout(this.timeout),this.timeout=null);a=this.getEffectiveInputValue();if(a!==this.validatedValue)if(""!==a||this.options.validateEmpty)this.validatedValue=a,XF.ajax("POST",XF.canonicalizeUrl(this.options.validationUrl),{field:this.target.getAttribute("name"),content:a},this.handleResponse.bind(this));else{const b=this.errorElement;XF.Transition.removeClassTransitioned(b,"is-active",()=>{b.innerHTML=""})}},getEffectiveInputValue(){let a=this.target.value;
this.options.trim&&(a=a.trim());return a},handleResponse(a){if(!a.validatedValue||a.validatedValue===this.getEffectiveInputValue()){var b=a.inputErrors;if(!a.inputValid&&b){let c;"object"==typeof b?1===b.length?c=b[0]:(c="<ul>",b.forEach(e=>{c+=`<li>${e}</li>`}),c+="</ul>"):c=b;this.errorElement.innerHTML=c;XF.Transition.addClassTransitioned(this.errorElement,"is-active")}else{a.inputValid||console.error("Data is not valid, but no errors");const c=this.errorElement;XF.Transition.removeClassTransitioned(c,
"is-active",()=>{c.innerHTML=""})}}}});XF.CheckboxSelectDisabler=XF.Element.newHandler({options:{select:null},selects:null,checkboxes:null,init(){(this.selects=m.querySelectorAll(this.options.select))&&this.selects.length?(this.checkboxes=this.target.querySelectorAll('input[type="checkbox"]'),Array.from(this.checkboxes).forEach(a=>{XF.on(a,"click",this.update.bind(this))}),this.update()):console.warn("No select element(s) found using %s",this.options.select)},update(){const a=this.selects,b=[];Array.from(this.checkboxes).forEach(c=>
{const e=c.checked;Array.from(a).forEach(f=>{f.querySelectorAll(`option[value="${c.value}"]`).forEach(d=>{const k=d.selected,h=d.disabled,l=d.closest("select");let g=!1;h===e&&(d.disabled=!e,g=!0);!e&&k&&(d.selected=!1,l.getAttribute("multiple")||(l.querySelectorAll("option:enabled").selected=!0),g=!0);g&&b.push(l)})})});b.length&&[...(new Set(b))].forEach(c=>{XF.trigger(c,"select:refresh")})}});XF.AssetUpload=XF.Element.newHandler({options:{asset:"",name:"",entity:""},path:null,upload:null,init(){this.path=
this.target.querySelector(".js-assetPath");this.upload=this.target.querySelector(".js-uploadAsset");XF.on(this.upload,"change",this.changeFile.bind(this))},changeFile(a){if(""!=a.target.value){const b=new FormData;b.append("upload",a.target.files[0]);b.append("type",this.options.asset);b.append("entity",this.options.entity);b.append("name",this.options.name);XF.ajax("post",XF.canonicalizeUrl("admin.php?assets/upload"),b,this.ajaxResponse.bind(this))}},ajaxResponse(a){a.errors||a.exception||(a.path&&
(this.path.value=a.path),this.upload.value="")}});XF.Event.register("click","submit","XF.SubmitClick");XF.Element.register("ajax-submit","XF.AjaxSubmit");XF.Element.register("user-mentioner","XF.UserMentioner");XF.Element.register("emoji-completer","XF.EmojiCompleter");XF.Element.register("auto-submit","XF.AutoSubmit");XF.Element.register("check-all","XF.CheckAll");XF.Element.register("select-plus","XF.SelectPlus");XF.Element.register("desc-loader","XF.DescLoader");XF.Element.register("disabler",
"XF.Disabler");XF.Element.register("field-adder","XF.FieldAdder");XF.Element.register("form-submit-row","XF.FormSubmitRow");XF.Element.register("guest-username","XF.GuestUsername");XF.Element.register("min-length","XF.MinLength");XF.Element.register("textarea-handler","XF.TextAreaHandler");XF.Element.register("checkbox-select-disabler","XF.CheckboxSelectDisabler");XF.Element.register("password-hide-show","XF.PasswordHideShow");XF.Element.register("change-submit","XF.ChangeSubmit");XF.Element.register("input-validator",
"XF.InputValidator");XF.Element.register("asset-upload","XF.AssetUpload")})(window,document);
