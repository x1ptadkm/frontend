((b,e)=>{XF.KeyCaptcha=XF.Element.newHandler({options:{user:null,session:null,sign:null,sign2:null},form:null,code:null,init(){this.form=this.target.closest("form");XF.uniqueId(this.form);this.code=this.form.querySelector("input[name=keycaptcha_code]");XF.uniqueId(this.code);this.load();XF.on(this.form,"ajax-submit:error",this.reload.bind(this));XF.on(this.form,"ajax-submit:always",this.reload.bind(this))},load(){b.s_s_c_onload?this.create():(b.s_s_c_user_id=this.options.user,b.s_s_c_session_id=this.options.session,
b.s_s_c_captcha_field_id=this.code.getAttribute("id"),b.s_s_c_submit_button_id="sbutton-#-r",b.s_s_c_web_server_sign=this.options.sign,b.s_s_c_web_server_sign2=this.options.sign2,e.s_s_c_element=this.form,e.s_s_c_debugmode=1,e.querySelector("#div_for_keycaptcha")||e.body.append(XF.createElementFromString('<div id="div_for_keycaptcha"></div>')),XF.loadScript("https://backs.keycaptcha.com/swfs/cap.js"))},create(){b.s_s_c_onload(this.form.getAttribute("id"),this.code.getAttribute("id"),"sbutton-#-r")},
reload(a){b.s_s_c_onload&&(a.target.matches("form")||a.preventDefault(),this.load())}});XF.ReCaptcha=XF.Element.newHandler({options:{sitekey:null,invisible:null},reCaptchaTarget:null,reCaptchaId:null,invisibleValidated:!1,reloading:!1,init(){if(this.options.sitekey){var a=this.target.closest("form");if(this.options.invisible){const c=e.createElement("div"),d=this.target.closest(".formRow");XF.display(d,"none");d.insertAdjacentElement("afterend",c);this.reCaptchaTarget=c;XF.on(a,"ajax-submit:before",
this.beforeSubmit.bind(this))}else this.reCaptchaTarget=this.target;XF.on(a,"ajax-submit:error",this.reload.bind(this));XF.on(a,"ajax-submit:always",this.reload.bind(this));b.grecaptcha?this.create():(XF.ReCaptcha.Callbacks.push(this.create.bind(this)),XF.loadScript("https://www.recaptcha.net/recaptcha/api.js?onload=XFReCaptchaCallback&render=explicit"))}},create(){if(b.grecaptcha){var a={sitekey:this.options.sitekey,theme:XF.StyleVariation.getColorScheme()};this.options.invisible&&(a.size="invisible",
a.callback=this.complete.bind(this));this.reCaptchaId=grecaptcha.render(this.reCaptchaTarget,a)}},beforeSubmit(a){this.invisibleValidated||(a.preventDefault(),a.preventSubmit=!0,grecaptcha.execute())},complete(){this.invisibleValidated=!0;const a=this.target.closest("form");XF.trigger(a,"submit")},reload(){b.grecaptcha&&null!==this.reCaptchaId&&!this.reloading&&(this.reloading=!0,setTimeout(()=>{grecaptcha.reset(this.reCaptchaId);this.invisibleValidated=this.reloading=!1},50))}});XF.ReCaptcha.Callbacks=
[];b.XFReCaptchaCallback=()=>{for(const a of XF.ReCaptcha.Callbacks)a()};XF.Turnstile=XF.Element.newHandler({options:{sitekey:null,action:""},turnstileTarget:null,turnstileId:null,reloading:!1,init(){if(this.options.sitekey){var a=this.target.closest("form");this.turnstileTarget=this.target;XF.on(a,"ajax-submit:error",this.reload.bind(this));XF.on(a,"ajax-submit:always",this.reload.bind(this));b.turnstile?this.create():(XF.Turnstile.Callbacks.push(this.create.bind(this)),XF.loadScript("https://challenges.cloudflare.com/turnstile/v0/api.js?onload=XFTurnstileCaptchaCallback"))}},
create(){if(b.turnstile){var a={sitekey:this.options.sitekey,theme:XF.StyleVariation.getColorScheme(),action:this.options.action};this.turnstileId=b.turnstile.render(this.turnstileTarget,a)}},complete(){const a=this.target.closest("form");XF.trigger(a,"submit")},reload(){b.turnstile&&null!==this.turnstileId&&!this.reloading&&(this.reloading=!0,setTimeout(()=>{b.turnstile.reset(this.turnstileId);this.reloading=!1},50))}});XF.Turnstile.Callbacks=[];b.XFTurnstileCaptchaCallback=()=>{for(const a of XF.Turnstile.Callbacks)a()};
XF.HCaptcha=XF.Element.newHandler({options:{sitekey:null,invisible:null},hCaptchaTarget:null,hCaptchaId:null,invisibleValidated:!1,reloading:!1,init(){if(this.options.sitekey){var a=this.target.closest("form");XF.on(a,"ajax-submit:error",this.reload.bind(this));XF.on(a,"ajax-submit:always",this.reload.bind(this));if(this.options.invisible){const c=e.createElement("div"),d=this.target.closest(".formRow");XF.display(d,"none");d.insertAdjacentElement("afterend",c);this.hCaptchaTarget=c;XF.on(a,"ajax-submit:before",
this.beforeSubmit.bind(this))}else this.hCaptchaTarget=this.target;b.hcaptcha?this.create():(XF.HCaptcha.Callbacks.push(this.create.bind(this)),XF.loadScript("https://hcaptcha.com/1/api.js?onload=XFHCaptchaCallback&render=explicit"))}},create(){if(b.hcaptcha){var a={sitekey:this.options.sitekey,theme:XF.StyleVariation.getColorScheme()};this.options.invisible&&(a.size="invisible",a.callback=this.complete.bind(this));this.hCaptchaId=b.hcaptcha.render(this.hCaptchaTarget,a)}},beforeSubmit(a){this.invisibleValidated||
(a.preventDefault(),a.preventSubmit=!0,b.hcaptcha.execute(this.hCaptchaId))},complete(){this.invisibleValidated=!0;const a=this.target.closest("form");XF.trigger(a,"submit")},reload(){b.hcaptcha&&null!==this.hCaptchaId&&!this.reloading&&(this.reloading=!0,setTimeout(()=>{b.hcaptcha.reset(this.hCaptchaId);this.invisibleValidated=this.reloading=!1},50))}});XF.HCaptcha.Callbacks=[];b.XFHCaptchaCallback=()=>{for(const a of XF.HCaptcha.Callbacks)a()};XF.QaCaptcha=XF.Element.newHandler({options:{url:null},
reloading:!1,init(){if(this.options.url){var a=this.target.closest("form");XF.on(a,"ajax-submit:error",this.reload.bind(this));XF.on(a,"ajax-submit:always",this.reload.bind(this))}},reload(){this.reloading||(this.reloading=!0,XF.ajax("get",this.options.url,this.show.bind(this)))},show(a){const c=this.target;XF.setupHtmlInsert(a.html,(d,f,g)=>{XF.display(d,"none");c.after(d);XF.Animate.fadeUp(c,{speed:XF.config.speed.fast,complete(){XF.Animate.fadeDown(d,{speed:XF.config.speed.fast});c.remove()}});
this.reloading=!1;g(!1,d)})}});XF.GuestCaptcha=XF.Element.newHandler({options:{url:"index.php?misc/captcha&with_row=1",captchaContext:"",target:".js-captchaContainer",skip:"[name=more_options]"},captchaContainer:null,initialized:!1,init(){const a=this.target;this.captchaContainer=a.querySelector(this.options.target);XF.on(a,"focusin",this.initializeCaptcha.bind(this));XF.on(a,"submit",this.submit.bind(this));XF.on(a,"ajax-submit:before",this.submit.bind(this))},initializeCaptcha(a){a=e.activeElement;
this.initialized||a.matches(this.options.skip)||(a=this.captchaContainer.dataset.rowType||"",XF.ajax("get",XF.canonicalizeUrl(this.options.url),{row_type:a,context:this.options.captchaContext},this.showCaptcha.bind(this)),this.initialized=!0)},showCaptcha(a){XF.setupHtmlInsert(a.html,(c,d,f)=>{this.captchaContainer.replaceWith(c);f()})},submit(a){this.initialized||e.activeElement.matches(this.options.skip)||(a.preventDefault(),a.stopPropagation())}});XF.Element.register("key-captcha","XF.KeyCaptcha");
XF.Element.register("re-captcha","XF.ReCaptcha");XF.Element.register("turnstile","XF.Turnstile");XF.Element.register("h-captcha","XF.HCaptcha");XF.Element.register("qa-captcha","XF.QaCaptcha");XF.Element.register("guest-captcha","XF.GuestCaptcha")})(window,document);
