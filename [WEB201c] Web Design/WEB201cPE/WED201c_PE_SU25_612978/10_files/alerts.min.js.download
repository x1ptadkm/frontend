var SV=window.SV||{};SV.AlertImprovements=SV.AlertImprovements||{};SV.$=SV.$||window.jQuery||null;SV.extendObject=SV.extendObject||XF.extendObject||jQuery.extend;
((l,g)=>{const h=SV.$,k="function"!==typeof XF.on;SV.AlertImprovements.invalidSelectorsToRemove=[".alert--unsummarize",".alert--mark-read",".alert--mark-unread"];SV.AlertImprovements.updateAlert=(a,b,d)=>{const c=a.classList.contains("is-unread");a.classList.remove("is-read");c?(a.classList.add("is-recently-read"),a.classList.remove("is-unread")):(a.classList.remove("is-recently-read"),a.classList.add("is-unread"));a.dataset.alertId&&b?a.replaceChildren(b):d?a.remove():SV.AlertImprovements.invalidSelectorsToRemove.forEach(e=>
{(e=a.querySelector(e))&&e.remove()})};SV.AlertImprovements.AlertToggler=XF.Event.newHandler({eventNameSpace:"SVAlertImprovementsAlertTogglerClick",eventType:"click",options:{successMessageFlashTimeOut:3E3},processing:null,init(){this.processing=!1},click(a){a.preventDefault();a=this.target||this.$target.get(0);var b=a.closest(".js-alert").dataset.alertId;if(b&&!this.processing){this.processing=!0;var d=!!g.querySelector(".js-alert[data-alert-id='"+b+"'] > [data-pop-up='0']");b=!!g.querySelector(".js-alert[data-alert-id='"+
b+"'] > [data-pop-up='1']");XF.ajax("POST",a.getAttribute("href"),{list:d?1:0,popup:b?1:0},this.handleMarkReadAjax.bind(this))}},handleMarkReadAjax(a){this.processing=!1;const b=(this.target||this.$target.get(0)).closest(".js-alert").dataset.alertId;b&&(a.message&&XF.flashMessage(a.message,this.options.successMessageFlashTimeOut),XF.setupHtmlInsert(a.html,d=>{k&&(d=d.get(0));let c=d.querySelector("[data-alert-id='"+b+"'] > [data-pop-up='0']");c&&g.querySelectorAll(".js-alert[data-alert-id='"+b+"'] > [data-pop-up='0']").forEach(f=>
{SV.AlertImprovements.updateAlert(f.parentElement,c,!1)});let e=d.querySelector("[data-alert-id='"+b+"'] > [data-pop-up='1']");e&&g.querySelectorAll(".js-alert[data-alert-id='"+b+"'] > [data-pop-up='1']").forEach(f=>{SV.AlertImprovements.updateAlert(f.parentElement,e,!1)});return!1}))}});SV.AlertImprovements.BulkMarkRead=XF.Event.newHandler({eventNameSpace:"SVAlertImprovementsAlertListMarkReadClick",eventType:"click",options:{successMessageFlashTimeOut:3E3},processing:null,confirmOverlay:null,init(){this.processing=
!1},click(a){a.preventDefault();if(!this.processing){this.processing=!0;this.confirmOverlay&&(this.confirmOverlay.destroy(),this.confirmOverlay=null);a=(this.target||this.$target.get(0)).getAttribute("href");var b=[],d=[],c=g.querySelectorAll(".js-alert.is-unread[data-alert-id] > [data-pop-up='0']"),e=g.querySelectorAll(".js-alert.is-unread[data-alert-id] > [data-pop-up='1']");c.forEach(f=>{(f=f.parentElement.dataset.alertId)&&b.push(f)});e.forEach(f=>{(f=f.parentElement.dataset.alertId)&&d.push(f)});
XF.ajax("POST",a,{list_alert_ids:b,popup_alert_ids:d},this.handleMarkAllReadAjax.bind(this))}},handleOverlayConfirm(a,b){b=b||a.data;a.preventDefault();this.confirmOverlay&&this.confirmOverlay.hide();this.handleMarkAllReadAjax(b)},handleOverlayClose(a,b){a.preventDefault();this.confirmOverlay&&(this.confirmOverlay.destroy(),this.confirmOverlay=null)},handleMarkAllReadAjax(a){this.processing=!1;"unconfirmed"in a&&a.unconfirmed?XF.setupHtmlInsert(a.html,(b,d)=>{b=XF.getOverlayHtml({html:b,title:d.h1||
d.title});this.confirmOverlay=XF.showOverlay(b);b=this.confirmOverlay.container||this.confirmOverlay.$container.get(0);d=b.querySelector("form");k?(h(d).on("ajax-submit:response",this.handleOverlayConfirm.bind(this)),h(b).on("overlay:hidden",this.handleOverlayClose.bind(this))):(XF.on(d,"ajax-submit:response",this.handleOverlayConfirm.bind(this)),XF.on(b,"overlay:hidden",this.handleOverlayClose.bind(this)))}):(a.message&&XF.flashMessage(a.message,this.options.successMessageFlashTimeOut),"ok"===a.status&&
(a.redirect?g.querySelectorAll(".js-alert[data-alert-id].is-unread").forEach(b=>{SV.AlertImprovements.updateAlert(b,null,!1)}):XF.setupHtmlInsert(a.html,b=>{k&&(b=b.get(0));let d=[];b.querySelectorAll("[data-alert-id] > [data-pop-up='0']").forEach(c=>{const e=c.parentElement.dataset.alertId;e&&(d[e]=c)});g.querySelectorAll(".js-alert.is-unread[data-alert-id] > [data-pop-up='0']").forEach(c=>{c=c.parentElement;SV.AlertImprovements.updateAlert(c,d[c.dataset.alertId])});d=[];b.querySelectorAll("[data-alert-id] > [data-pop-up='1']").forEach(c=>
{const e=c.parentElement.dataset.alertId;e&&(d[e]=c)});g.querySelectorAll(".js-alert.is-unread[data-alert-id] > [data-pop-up='1']").forEach(c=>{c=c.parentElement;SV.AlertImprovements.updateAlert(c,d[c.dataset.alertId])});return!1})))}});SV.AlertImprovements.AlertUnsummarize=XF.Event.newHandler({eventNameSpace:"SVAlertImprovementsAlertUnsummarizeClick",eventType:"click",options:{alertPopupSelector:".p-navgroup-link--alerts",successMessageFlashTimeOut:3E3},processing:null,init(){this.processing=!1},
click(a){a.preventDefault();this.processing||(this.processing=!0,a=this.target||this.$target.get(0),XF.ajax("POST",a.getAttribute("href"),{},this.handleReloadAlertsPopupList.bind(this)))},handleReloadAlertsPopupList(a){this.processing=!1;a.message&&XF.flashMessage(a.message,this.options.successMessageFlashTimeOut);(a=(this.target||this.$target.get(0)).closest(".js-alert").dataset.alertId)&&g.querySelectorAll(".js-alert[data-alert-id='"+a+"']").forEach(b=>{b.remove()})}});SV.AlertImprovements.FadeReadAlerts=
XF.Element.newHandler({options:{classSelector:"li.is-just-read",classToRemove:"is-just-read",classToAdd:"was-just-read",transitionDuration:0,transitionDelay:2},init(){const a=this.options,b=Math.max(0,a.transitionDuration|0),d=Math.max(0,a.transitionDelay|0),c=(this.target||this.$target.get(0)).querySelectorAll(a.classSelector);c&&c.length&&(b?setTimeout(()=>{c.forEach(e=>{e.style.transitionDuration=b+"s";"undefined"!==typeof XF.Transition?(XF.Transition.removeClassTransitioned(e,a.classToRemove),
XF.Transition.addClassTransitioned(e,a.classToAdd)):h(e).removeClassTransitioned(a.classToRemove).addClassTransitioned(a.classToAdd)})},1E3*d):c.forEach(e=>{e.classList.add(a.classToAdd);e.classList.remove(a.classToRemove)}))}});XF.Element.extend("tooltip",{__backup:{init:"svAlertImprovementsTooltipAliasedInit"},options:SV.extendObject({},XF.Tooltip.prototype.options,{positionOver:null}),init(){this.svAlertImprovementsTooltipAliasedInit();null!==this.options.positionOver&&this.tooltip.setPositioner(XF.findRelativeIf(this.options.positionOver,
this.target||this.$target))}});XF.Event.register("click","sv-mark-alerts-read","SV.AlertImprovements.BulkMarkRead");XF.Event.register("click","mark-alert-unread","SV.AlertImprovements.AlertToggler");XF.Event.register("click","unsummarize-alert","SV.AlertImprovements.AlertUnsummarize");XF.Element.register("fade-read-alerts","SV.AlertImprovements.FadeReadAlerts")})(window,document);
